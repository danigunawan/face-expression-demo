(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(t,e,s){"use strict";s.r(e);s(12),s(13);var i=s(10);window.faceapi=i,s(23)},19:function(t,e){},20:function(t,e){},21:function(t,e){},23:function(t,e,s){"use strict";s.r(e);const i=new class{constructor(){}convertStrToBool(t){return"true"===t}getEnv(){return"local"}getDebug(){return this.convertStrToBool("true")}getDebugDetections(){return this.convertStrToBool("false")}getDebugExpressions(){return this.convertStrToBool("false")}getDebugKeyboard(){return this.convertStrToBool("false")}getDebugLogLevel(){return"0"}getDevTriggers(){return["dev","development","local","local"]}findLogLevel(t){switch(t.toLowerCase()){case"states":return 1;case"events":return 2;case"controls":return 3;case"elements":return 4;case"others":return 5;default:return 0}}showMarkers(){return this.showDetections()||this.showExpressions()}showDetections(){return this.isDebug()&&this.getDebugDetections()}showExpressions(){return this.isDebug()&&this.getDebugExpressions()}showKeyboard(){return this.isDebug()&&this.getDebugKeyboard()}isDev(){return this.getDevTriggers().indexOf(this.getEnv().toLowerCase())>=0}isDebug(){return this.getDebug()}};const n=new class{constructor(){}log(t,e){this.canLog(e)&&t&&console.log(t)}canLog(t){let e=i.getDebugLogLevel();return!!i.getDebug()&&(e<0?-1*e==t:t<=e)}};const a=new class{constructor(){this.events=[]}register(t,e){let s=this.findEvent(t);s?s.callbacks.push(e):this.createEvent(t,e)}emit(t,e){let s=this.findEvent(t);s&&(s.callbacks.forEach(t=>{t(e)}),this.log("emit() : Emitting event `"+t+"`!\n"+(void 0!==e?"\nParameters : {"+e+"}":"")))}createEvent(t,e){this.findEvent(t)||this.events.push({name:t,callbacks:[e]})}findEvent(t){return this.events.find(e=>e.name===t)}log(t){n.log("EventBus.js | "+t,i.findLogLevel("events"))}reportEvents(){console.log("EventBus.js | reportEvents() : Registered `Events`..."),console.log(this.events)}};const r=new class{constructor(){}getElementById(t){let e=document.getElementById(t);return e||console.error("Element with ID of '"+t+"' not found!")}getElementByClass(t){let e=document.getElementsByClassName(t);return e.length>0?e[0]:console.error("Element with class name of '"+t+"' not found!")}rgbToColor(t,e,s,i=null){return null!=i?new BABYLON.Color4(t/255,e/255,s/255,i):new BABYLON.Color3(t/255,e/255,s/255)}getAlphaFromPixel(t,e){return t[4*e+3]}runCollection(t,e,s=null){if(t)for(var i=0;i<t.length;i++){let n=t[i];"function"==typeof n[e]&&n[e](s)}}getFromArrByName(t,e,s=!1){let i=s?[]:null;for(var n=0;n<t.length;n++){let a=t[n];if(a.name&&a.name.toLowerCase().indexOf(e.toLowerCase())>-1){if(!s)return a;i.push(a)}}return i}isObject(t){let e=typeof obj;return"function"===e||"object"===e&&!!obj}hasObject(t,e){for(var s=0;s<t.length;s++)if(t[s]===e)return!0;return!1}};const o=new class{constructor(){this.isStartGame=!1,this.isSpawning=!1,this.isPaused=!1,this.isDetecting=!1,this.hasDetection=!1,this.round={startTime:null,endTime:null,score:0},this.bindEvents()}detecting(t=!0){this.isDetecting=t}gameStart(t=!0){this.isStartGame=t,t?this.setCurrStartTime():(this.setCurrEndTime(),this.paused(!1))}paused(t=!0){this.isPaused=t}spawning(t=!0){this.isSpawning=t}addScore(t){this.round.score+=parseInt(t)}bindEvents(){a.register("onStartGame",()=>{this.gameStart()}),a.register("onPauseGame",t=>{this.paused(t)}),a.register("onEndGame",()=>{this.gameStart(!1)}),a.register("onHasDetection",()=>{this.hasDetection=!0}),a.register("onDetecting",t=>{this.detecting(t)}),a.register("onSpawnEnable",t=>{this.spawning(t)}),a.register("hasScored",t=>{this.addScore(t)})}getCurrScore(){return this.round.score}setCurrStartTime(t=null){let e=t||new Date;this.round.startTime=e}setCurrEndTime(t=null){let e=t||new Date;this.round.endTime=e}isPlaying(){return!(!this.isStartGame||this.isPaused)}};const h=new class{constructor(){this.minimizeWidth=600}init(){}};const c=new class{constructor(){this.minimizeClass="video--minimize",this.modelsUri="./face-expression-demo/assets/models",this.detectionInterval=100}init(){}};const l=new class{constructor(){this.activeClass="menu--active"}init(){}};const u=new class{constructor(){this.id="loading"}init(){}};const d=new class{constructor(){this.activeClass="label--active"}init(){}};class g{constructor(t,e){this.panelName=t,this.attributes=e,this._initGUI()}_initGUI(){this._setupLabels()}_setupLabels(){this.panel=r.getElementById(this.panelName)}show(){this.panel.classList.add(this.attributes.activeClass)}hide(){this.panel.classList.remove(this.attributes.activeClass)}}class p extends g{constructor(t){super(t,d),this._initLabel()}_initLabel(){}}class m extends p{constructor(){super(u.id),this.init()}init(){this.setupLabels(),this.bindEvents()}setupLabels(){}bindEvents(){}log(t){n.log("LoadingLabel.js | "+t,i.findLogLevel("elements"))}}const v=new class{constructor(){this.id="face-detection",this.minimizeClass="face-detection--minimize",this.waitingClass="face-detection--waiting",this.detectedClass="face-detection--detected",this.notDetectedClass="face-detection--not-detected"}init(){}};class w extends p{constructor(){super(v.id),this.init()}init(){this.bindEvents()}bindEvents(){a.register("onDetecting",t=>{this.onDetecting(t)})}onDetecting(t){t?this.detected():this.notDetected()}detected(){this.setClassname(v.detectedClass,v.notDetectedClass)}notDetected(){this.setClassname(v.notDetectedClass,v.detectedClass)}log(t){n.log("DetectLabel.js | "+t,i.findLogLevel("elements"))}setClassname(t,e){this.panel.classList.remove(e),this.panel.classList.add(t)}}const b=new class{constructor(){this.id="face-expression",this.iconClassName="face-expression__icon",this.labelClassName="face-expression__label",this.iconClassPrefix="fa-",this.iconDefaultClass=this.iconClassPrefix+"question-circle",this.detectedClass="face-expression--detected"}init(){}};class x extends p{constructor(){super(b.id),this.init()}init(){this.setupLabels(),this.bindEvents()}setupLabels(){this.icon=r.getElementByClass(b.iconClassName),this.label=r.getElementByClass(b.labelClassName)}bindEvents(){a.register("onDetecting",t=>{this.onDetecting(t)}),a.register("onExpressionChange",t=>{this.setExpressionIcon(t)})}onDetecting(t){t?this.enable():this.disable()}enable(){this.panel.classList.add(b.detectedClass)}disable(){this.panel.classList.remove(b.detectedClass)}removeIconClass(){let t=this.icon.classList;for(var e=0;e<t.length;e++){let s=t[e];s.indexOf(b.iconClassPrefix)>=0&&t.remove(s)}}log(t){n.log("ExpressionLabel.js | "+t,i.findLogLevel("elements"))}setExpressionIcon(t){this.removeIconClass();let e=this.getExpressionIcon(t);this.label.innerHTML=e.expression,this.icon.classList.add(e.icon)}getExpressionIcon(t){let e=null,s=null;switch(t){case"neutral":e="fa-meh";break;case"happy":e="fa-smile";break;case"surprised":e="fa-surprise";break;case"angry":e="fa-angry";break;case"sad":e="fa-frown";break;case"fearful":e=null;break;case"unknown":case"question":default:e=null,s="???"}return{expression:s||t,icon:e||this.iconDefaultClass}}}const f=new class{constructor(){this.id="score",this.scoreClassName="score__label",this.comboClassName="combo__label"}init(){}};class C extends p{constructor(){super(f.id),this.init()}init(){this.setupLabels(),this.bindEvents()}setupLabels(){this.scoreLabel=r.getElementByClass(f.scoreClassName)}bindEvents(){a.register("hasScored",()=>{this.updateScore()})}updateScore(){this.scoreLabel.innerHTML=o.getCurrScore()}log(t){n.log("ScoreLabel.js | "+t,i.findLogLevel("elements"))}}const y=new class{constructor(){this.id="start-menu",this.startGameBtnId="startGame"}init(){}};class E extends g{constructor(t){super(t,l),this._initMenu()}_initMenu(){}createButtons(t,e){let s=r.getElementById(t);s&&s.addEventListener("click",t=>{t.preventDefault(),e()})}}class D extends E{constructor(){super(y.id),this.init()}init(){this.setupButtons(),this.bindEvents()}setupButtons(){this.startBtn=this.createButtons(y.startGameBtnId,()=>{this.startGame()})}bindEvents(){}startGame(){a.emit("onStartGame")}log(t){n.log("StartMenu.js | "+t,i.findLogLevel("elements"))}}class S{constructor(t,e){this.canvas=t,this.context=e,this.init()}init(){this.labels=[],this.menus=[],this.buildElements(),this.bindEvents(),this.show(this.labels,[this.loadingLabel])}buildElements(){this.loadingLabel=this.addLabel(new m),this.detectLabel=this.addLabel(new w),this.expressionLabel=this.addLabel(new x),this.scoreLabel=this.addLabel(new C),this.startMenu=this.addMenu(new D)}addLabel(t){return this.addToCollection(this.labels,t)}addMenu(t){return this.addToCollection(this.menus,t)}addToCollection(t,e){return t.push(e),e}bindEvents(){a.register("onHasDetection",()=>{this.onHasDetection()}),a.register("onStartGame",()=>{this.onStartGame()})}onHasDetection(){this.show(this.labels,[]),this.show(this.menus,[this.startMenu])}onStartGame(){this.show(this.menus,[]),this.show(this.labels,[this.expressionLabel,this.detectLabel,this.scoreLabel])}show(t,e){for(var s=0;s<t.length;s++){let i=t[s];r.hasObject(e,i)?i.show():i.hide()}}minimize(){r.runCollection(this.menus,"minimize"),r.runCollection(this.labels,"minimize")}maximize(){r.runCollection(this.menus,"maximize"),r.runCollection(this.labels,"maximize")}update(){}draw(){}}const M=new class{constructor(){}init(){}getExpressions(){return{neutral:0,happy:0,surprised:0,angry:0}}};class L{constructor(t,e){this.video=t,this.body=e,i.showKeyboard()?this.bindDebugKeyboard():this.init()}init(){this.loading=!1,this.setupAssets(),this.hasDebugCanvas=!1}setupAssets(){Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(c.modelsUri),faceapi.nets.faceExpressionNet.loadFromUri(c.modelsUri)]).then(()=>{this.setupStream()})}setupStream(){void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(t){return navigator.webkitGetUserMedia||navigator.mozGetUserMedia?new Promise((function(e,s){getUserMedia.call(navigator,t,e,s)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then(t=>{"srcObject"in this.video?this.video.srcObject=t:this.video.src=window.URL.createObjectURL(t),this.video.onloadedmetadata=()=>{this.stream()}}).catch(t=>{console.log("We encountered an error trying to access your camera. Please allow the app permission to continue. "+t)})}stream(){this.video.play(),this.video.addEventListener("play",()=>{setInterval(async()=>{this.detect()},c.detectionInterval)})}detect(){this.loading||(this.loading=!0,faceapi.detectSingleFace(this.video,new faceapi.TinyFaceDetectorOptions({scoreThreshold:.4})).withFaceExpressions().then(t=>{this.debugCanvas&&this.debugCanvas.getContext("2d").clearRect(0,0,this.debugCanvas.width,this.debugCanvas.height),t?this.setDetections(t):o.isDetecting&&a.emit("onDetecting",!1),this.loading=!1,o.hasDetection||a.emit("onHasDetection")},t=>{this.log("ERROR: "+t)}))}log(t){n.log("FaceDetect.js | "+t,i.findLogLevel("elements"))}setDetections(t){this.detections=t,a.emit("onFaceDetect",t),o.isDetecting||a.emit("onDetecting",!0),i.showMarkers()&&this.showFaceMarkers(t)}getVideoSize(){return{width:this.video.width,height:this.video.height}}bindDebugKeyboard(){a.emit("onHasDetection",!0),a.emit("onDetection",!0),document.onkeydown=t=>{let e={expressions:M.getExpressions()};switch(t.keyCode){case 37:e.expressions.happy=1;break;case 38:e.expressions.neutral=1;break;case 39:e.expressions.angry=1;break;case 40:e.expressions.surprised=1}a.emit("onFaceDetect",e)}}createDebugCanvas(){this.debugCanvas=faceapi.createCanvasFromMedia(this.video),this.body.append(this.debugCanvas),faceapi.matchDimensions(this.debugCanvas,this.getVideoSize()),this.hasDebugCanvas=!0}showFaceMarkers(t){this.hasDebugCanvas||this.createDebugCanvas();const e=faceapi.resizeResults(t,this.getVideoSize());i.showDetections()&&faceapi.draw.drawDetections(this.debugCanvas,e),i.showExpressions()&&faceapi.draw.drawFaceExpressions(this.debugCanvas,e)}}class T{constructor(t,e){this.x=t,this.y=e}clear(){this.x=0,this.y=0}normalize(){let t=this.getLength();t>0&&(this.x=this.x/t,this.y=this.y/t)}add(t){return new T(this.x+t.x,this.y+t.y)}subtract(t){return new T(this.x-t.x,this.y-t.y)}multiply(t){return new T(this.x*t,this.y*t)}divide(t){return new T(this.x/t,this.y/t)}addTo(t){this.x+=t.x,this.y+=t.y}subtractTo(t){this.x-=t.x,this.y-=t.y}multiplyBy(t){this.x*=t,this.y*=t}divideBy(t){this.x/=t,this.y/=t}setAngle(t){let e=this.getLength();this.x=Math.cos(t)*e,this.y=Math.sin(t)*e}getAngle(){return Math.atan2(this.y,this.x)}setLength(t){let e=this.getAngle();this.x=Math.cos(e)*t,this.y=Math.sin(e)*t}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}}class I{constructor(t){this._init()}_init(){}setupCanvasVars(){}setupSize(){}onWindowResize(t){this.setupSize(t),this.setupCanvasVars()}}const B=new class{constructor(){this.font="Permanent Marker",this.fontSize=50,this.animDuration=800}init(){}getFontHeight(t=null){return.35*(t||this.fontSize)}};const F=new class{constructor(){this.font="Font Awesome 5 Free",this.fontSize=90,this.toggleDuration=500,this.moveDuration=1e4,this.minMoveDuration=1500,this.defaultColor="#f6e58d",this.activeColor="#f9ca24",this.disableColor="#e74c3c"}getFontHeight(t=null){return.5*(t||this.fontSize)}};class O{constructor(t,e,s,i,n=null,a=null){for(var r in this.obj=t,this.props=e,this.duration=s,this.easingFunc=i,this.onProgress=n,this.onComplete=a,this.starts={},this.changes={},this.startTime=new Date,this.props)this.hasProp(r)&&(this.starts[r]=this.obj[r],this.changes[r]=this.props[r]-this.starts[r]);this.start()}start(){this.remainingTime=new Date-this.startTime,this.remainingTime<this.duration?(this.update(),this.onProgress&&this.onProgress(),requestAnimationFrame(()=>{this.start()})):(this.remainingTime=this.duration,this.update(),this.onComplete&&this.onComplete())}update(){for(var t in this.props)this.hasProp(t,!1)&&(this.obj[t]=this.easingFunc(this.remainingTime,this.starts[t],this.changes[t],this.duration))}hasProp(t,e=!0){return!!this.obj.hasOwnProperty(t)||(e&&console.warn("[Warning] Tween.js : Property of `"+t+"` not found"),!1)}static linearTween(t,e,s,i){return s*t/i+e}static easeInQuad(t,e,s,i){return s*(t/=i)*t+e}static easeOutQuad(t,e,s,i){return-s*(t/=i)*(t-2)+e}static easeInOutQuad(t,e,s,i){return(t/=i/2)<1?s/2*t*t+e:-s/2*(--t*(t-2)-1)+e}static easeInCubic(t,e,s,i){return s*(t/=i)*t*t+e}static easeOutCubic(t,e,s,i){return s*((t=t/i-1)*t*t+1)+e}static easeInOutCubic(t,e,s,i){return(t/=i/2)<1?s/2*t*t*t+e:s/2*((t-=2)*t*t+2)+e}static easeInQuart(t,e,s,i){return s*(t/=i)*t*t*t+e}static easeOutQuart(t,e,s,i){return-s*((t=t/i-1)*t*t*t-1)+e}static easeInOutQuart(t,e,s,i){return(t/=i/2)<1?s/2*t*t*t*t+e:-s/2*((t-=2)*t*t*t-2)+e}static easeInQuint(t,e,s,i){return s*(t/=i)*t*t*t*t+e}static easeOutQuint(t,e,s,i){return s*((t=t/i-1)*t*t*t*t+1)+e}static easeInOutQuint(t,e,s,i){return(t/=i/2)<1?s/2*t*t*t*t*t+e:s/2*((t-=2)*t*t*t*t+2)+e}static easeInSine(t,e,s,i){return-s*Math.cos(t/i*(Math.PI/2))+s+e}static easeOutSine(t,e,s,i){return s*Math.sin(t/i*(Math.PI/2))+e}static easeInOutSine(t,e,s,i){return-s/2*(Math.cos(Math.PI*t/i)-1)+e}static easeInExpo(t,e,s,i){return 0==t?e:s*Math.pow(2,10*(t/i-1))+e}static easeOutExpo(t,e,s,i){return t==i?e+s:s*(1-Math.pow(2,-10*t/i))+e}static easeInOutExpo(t,e,s,i){return 0==t?e:t==i?e+s:(t/=i/2)<1?s/2*Math.pow(2,10*(t-1))+e:s/2*(2-Math.pow(2,-10*--t))+e}static easeInCirc(t,e,s,i){return-s*(Math.sqrt(1-(t/=i)*t)-1)+e}static easeOutCirc(t,e,s,i){return s*Math.sqrt(1-(t=t/i-1)*t)+e}static easeInOutCirc(t,e,s,i){return(t/=i/2)<1?-s/2*(Math.sqrt(1-t*t)-1)+e:s/2*(Math.sqrt(1-(t-=2)*t)+1)+e}static easeInElastic(t,e,s,i){var n=1.70158,a=0,r=s;if(0==t)return e;if(1==(t/=i))return e+s;if(a||(a=.3*i),r<Math.abs(s)){r=s;n=a/4}else n=a/(2*Math.PI)*Math.asin(s/r);return-r*Math.pow(2,10*(t-=1))*Math.sin((t*i-n)*(2*Math.PI)/a)+e}static easeOutElastic(t,e,s,i){var n=1.70158,a=0,r=s;if(0==t)return e;if(1==(t/=i))return e+s;if(a||(a=.3*i),r<Math.abs(s)){r=s;n=a/4}else n=a/(2*Math.PI)*Math.asin(s/r);return r*Math.pow(2,-10*t)*Math.sin((t*i-n)*(2*Math.PI)/a)+s+e}static easeInOutElastic(t,e,s,i){var n=1.70158,a=0,r=s;if(0==t)return e;if(2==(t/=i/2))return e+s;if(a||(a=i*(.3*1.5)),r<Math.abs(s)){r=s;n=a/4}else n=a/(2*Math.PI)*Math.asin(s/r);return t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*i-n)*(2*Math.PI)/a)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*i-n)*(2*Math.PI)/a)*.5+s+e}static easeInBack(t,e,s,i,n){return null==n&&(n=1.70158),s*(t/=i)*t*((n+1)*t-n)+e}static easeOutBack(t,e,s,i,n){return null==n&&(n=1.70158),s*((t=t/i-1)*t*((n+1)*t+n)+1)+e}static easeInOutBack(t,e,s,i,n){return null==n&&(n=1.70158),(t/=i/2)<1?s/2*(t*t*((1+(n*=1.525))*t-n))+e:s/2*((t-=2)*t*((1+(n*=1.525))*t+n)+2)+e}static easeInBounce(t,e,s,i){return s-O.easeOutBounce(i-t,0,s,i)+e}static easeOutBounce(t,e,s,i){return(t/=i)<1/2.75?s*(7.5625*t*t)+e:t<2/2.75?s*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?s*(7.5625*(t-=2.25/2.75)*t+.9375)+e:s*(7.5625*(t-=2.625/2.75)*t+.984375)+e}static easeInOutBounce(t,e,s,i){return t<i/2?.5*O.easeInBounce(2*t,0,s,i)+e:.5*O.easeOutBounce(2*t-i,0,s,i)+.5*s+e}}class P{static quadraticBezier(t,e,s,i,n){t.x=Math.pow(1-n,2)*e.x+2*(1-n)*n*s.x+n*n*i.x,t.y=Math.pow(1-n,2)*e.y+2*(1-n)*n*s.y+n*n*i.y}static cubicBezier(t,e,s,i,n,a){t.x=Math.pow(1-a,3)*e.x+3*Math.pow(1-a,2)*a*s.x+3*(1-a)*a*a*i.x+a*a*a*n.x,t.y=Math.pow(1-a,3)*e.y+3*Math.pow(1-a,2)*a*s.y+3*(1-a)*a*a*i.y+a*a*a*n.y}static randomInt(t,e,s=!0){let i=t+Math.random()*(e-t);return s?Math.floor(i):i}static lerp(t,e,s){return(s-e)*t+e}static clamp(t,e,s){return Math.min(Math.max(t,e),s)}static percentOf(t,e){return t*(e/100)}static radianToDegrees(t){return 180*t/Math.PI}static degreeToRadians(t){return t*Math.PI/180}static inRange(t,e,s){return t>=Math.min(e,s)&&t<=Math.max(e,s)}static rangeIntersect(t,e,s,i){return Math.max(t,e)>=Math.min(s,i)&&Math.min(t,e)<=Math.max(s,i)}}class z extends I{constructor(t,e,s,i){super(),this.canvas=t,this.context=e,this.position=s,this.attribute=i,this.init()}init(){this.currY=this.position.y,this.yGoal=this.currY-75,this.alphaGoal=0,this.currAlpha=1,this.fontGoal=B.fontSize,this.currFont=.6*B.fontSize,this.animDuration=B.animDuration,this.isAnimating=!1,this.onWindowResize(),this.bindEvents(),this.fadeOut()}bindEvents(){}fadeOut(){this.isAnimating||(this.isAnimating=!0,new O(this,{currY:this.yGoal,currFont:this.fontGoal,currAlpha:this.alphaGoal},this.animDuration,O.easeOutQuad,null,()=>{this.isAnimating=!1}))}update(){this.isAnimating}drawText(){this.context.save(),this.context.globalAlpha=this.currAlpha,this.context.font=this.getCanvasFont(),this.context.fillStyle=this.attribute.color,this.context.lineWidth=10,this.context.shadowBlur=15,this.context.shadowColor=this.attribute.color;let t=this.context.measureText(this.attribute.text);this.context.translate(this.position.x-t.width/2,this.currY+B.getFontHeight()),this.context.fillText(this.attribute.text.toUpperCase(),0,0),this.context.restore()}draw(){this.drawText()}log(t){n.log("Word.js | "+t,i.findLogLevel("elements"))}getCanvasFont(){return"400 "+this.currFont+"px '"+B.font+"'"}isDead(){return!1}}class A extends I{constructor(t,e){super(),this.canvas=t,this.context=e,this.init()}init(){this.words=[],this.bindEvents()}createWord(t,e){let s=new z(this.canvas,this.context,t,e);this.words.push(s)}bindEvents(){}spawn(t,e){this.createWord(t,e)}update(){if(o.isPlaying())for(var t=0;t<this.words.length;t++){this.words[t].isDead()&&this.words.splice(t,1)}}draw(){o.isPlaying()&&r.runCollection(this.words,"draw")}log(t){n.log("WordSpawner.js | "+t,i.findLogLevel("elements"))}}class G extends I{constructor(t,e){super(),this.canvas=t,this.context=e,this.init()}init(){this.reset(),this.bindEvents()}bindEvents(){a.register("onFaceDetect",t=>{this.onFaceDetect(t)})}onFaceDetect(t){t?this.setCoordinates(t):this.reset()}reset(){this.leftEyeBrow=[],this.rightEyeBrow=[],this.leftEye=[],this.rightEye=[],this.nose=[],this.mouth=[],this.jaw=[],this.expressions=M.getExpressions(),this.currExpression=null}update(){}draw(){}log(t){n.log("User.js | "+t,i.findLogLevel("elements"))}setCoordinates(t){t.expressions&&this.setExpressions(t.expressions)}setExpressions(t){for(var e in this.expressions)Object.prototype.hasOwnProperty.call(t,e)?this.expressions[e]=parseFloat(t[e].toFixed(4)):this.expressions[e]=0;this.setCurrExpression()}setCurrExpression(t=null){let e=t||this.getHighestExpression();e!=this.currExpression&&(this.currExpression=e,a.emit("onExpressionChange",e))}getHighestExpression(){let t=0,e=null;for(var s in this.expressions){let i=this.expressions[s];i>t&&(t=i,e=s)}return e}isExpression(t){return this.getHighestExpression()==t}}const W=new class{constructor(){this.interval=7e3,this.minInterval=1500,this.margin=20}getSpawnCoordinates(t,e=0){let s=P.percentOf(t.width,this.margin);return{min:s-e,max:t.width-s+e,y:t.height+F.getFontHeight()}}};class j extends I{constructor(t,e,s,i){super(),this.canvas=t,this.context=e,this.position=s,this.type=i,this.init()}init(){this.text=this.getTypeString(),this.defaultColor=F.defaultColor,this.activeColor=F.activeColor,this.disableColor=F.disableColor,this.currY=this.position.y,this.currFont=F.fontSize,this.fontGoal=1.5*this.currFont,this.currAlpha=1,this.alphaGoal=0,this.toggleDuration=F.toggleDuration,this.active=!1,this.enabled=!0,this.toggled=!1,this.onWindowResize(),this.bindEvents(),this.moveUp()}setupCanvasVars(){this.textSize=this.getTextMeasurement(),this.yGoal=1.25*-F.getFontHeight()}bindEvents(){}enable(t=!0){this.enabled=t}activate(t=!0){this.active=t}toggle(t=!0){this.toggled=t,this.fadeOut()}moveUp(){this.toggled||new O(this,{currY:this.yGoal},this.getSpeed(),O.linearTween)}fadeOut(){this.toggled&&new O(this,{currFont:this.fontGoal,currAlpha:this.alphaGoal},this.toggleDuration,O.easeOutQuad)}update(){}drawFace(){this.context.save();let t=this.getColor();this.toggled?(this.textSize=this.getTextMeasurement(),this.context.globalAlpha=this.currAlpha):this.enabled||(this.context.globalAlpha=.1),this.context.font=this.getCanvasFont(),this.context.fillStyle=t,this.context.lineWidth=10,this.context.shadowBlur=15,this.context.shadowColor=t,this.context.translate(this.position.x-this.textSize.width/2,this.currY+F.getFontHeight(this.currFont)),this.context.fillText(this.text,0,0),this.context.restore()}draw(){this.drawFace()}log(t){n.log("Face.js | "+t,i.findLogLevel("elements"))}getSpeed(){let t=o.getCurrScore(),e=0;return(e=F.moveDuration-t/2)<F.minMoveDuration&&(e=F.minMoveDuration),e}getTextMeasurement(){let t=null;return this.context.save(),this.context.font=this.getCanvasFont(),t=this.context.measureText(this.text),this.context.restore(),t}getCanvasFont(){return"400 "+this.currFont+"px '"+F.font+"'"}getColor(){return this.enabled||this.toggled?this.active?this.activeColor:this.defaultColor:this.disableColor}getTypeString(){switch(this.type){case"neutral":return"";case"happy":return"";case"surprised":return"";case"angry":return""}}isDead(){return this.toggled&&0==this.currAlpha||this.currY+F.fontSize<0}}class k extends I{constructor(t,e){super(),this.canvas=t,this.context=e,this.init()}init(){this.faces=[],this.faceTypes=this.setSpawnTypes(M.getExpressions()),this.lastSpawnType=null,this.delta=0,this.interval=0,this.bindEvents()}setupCanvasVars(){this.spawnCoords=W.getSpawnCoordinates(this.canvas)}createFace(){let t=new j(this.canvas,this.context,this.getSpawnLocation(),this.getSpawnType());this.faces.push(t)}bindEvents(){a.register("onStartGame",()=>{this.enable()}),a.register("onPauseGame",()=>{this.enable(!1)}),a.register("onEndGame",()=>{this.enable(!1)})}enable(t=!0){this.createFace(),a.emit("onSpawnEnable",t)}spawn(t){let e=!1;0==this.faces.length&&(e=!0),this.delta+=t,this.interval=this.getSpawnInterval(),this.delta>this.interval&&(e=!0),e&&(this.createFace(),this.delta=0)}update(t){if(o.isPlaying()){for(var e=0;e<this.faces.length;e++){let t=this.faces[e];t.isDead()?this.faces.splice(e,1):t.update()}o.isSpawning&&this.spawn(t)}}draw(){o.isPlaying()&&r.runCollection(this.faces,"draw")}log(t){n.log("FaceSpawner.js | "+t,i.findLogLevel("elements"))}getSpawnType(){let t=null;for(;!t||this.lastSpawnType==t;)t=this.faceTypes[P.randomInt(0,this.faceTypes.length)];return this.lastSpawnType=t,t}setSpawnTypes(t){let e=[];for(var s in t)e.push(s);return e}getSpawnLocation(){return new T(P.randomInt(this.spawnCoords.min,this.spawnCoords.max,!1),this.spawnCoords.y)}getSpawnInterval(){let t=o.getCurrScore(),e=0;return(e=W.interval-t)<W.minInterval&&(e=W.minInterval),e}}const U=new class{constructor(){this.hitBoundery=20,this.bounderyColor="white",this.bounderyWidth=10}init(){}getPerfect(){return this.getWordAttr("perfect","#2ecc71",250)}getGood(){return this.getWordAttr("good","#9b59b6",150)}getBad(){return this.getWordAttr("bad","#f39c12",100)}getMiss(){return this.getWordAttr("miss","#e74c3c",0)}getWordAttr(t,e,s){return{text:t,color:e,score:s}}};class H extends I{constructor(t,e,s,i,n){super(),this.canvas=t,this.context=e,this.user=s,this.faceSpawner=i,this.wordSpawner=n,this.init()}init(){this.bounderyColor=U.bounderyColor,this.bounderyWidth=U.bounderyWidth,this.currActive=null,this.bindEvents()}setupCanvasVars(){this.spawnCoords=W.getSpawnCoordinates(this.canvas,F.fontSize/2),this.topBoundery=P.percentOf(this.canvas.height,U.hitBoundery)}bindEvents(){}matched(t){let e=this.getMatchedPoint(t);switch(t.enable(!1),t.toggle(),e.text){case"perfect":this.perfect(t);break;case"good":this.good(t);break;case"bad":this.bad(t)}this.updateActive(),a.emit("hasScored",e.score)}perfect(t){this.addWord(t,U.getPerfect())}good(t){this.addWord(t,U.getGood())}bad(t){this.addWord(t,U.getBad())}miss(t){this.addWord(t,U.getMiss())}addWord(t,e){this.wordSpawner.spawn(new T(t.position.x,t.currY),e)}updateActive(){for(var t=0;t<this.faceSpawner.faces.length;t++){let e=this.faceSpawner.faces[t];if(e.enabled)return this.currActive=e.activate()}return this.currActive=null}update(){if(o.isPlaying()){let e=!1;for(var t=0;t<this.faceSpawner.faces.length;t++){let s=this.faceSpawner.faces[t];s.enabled&&this.isOutOfBounds(s)&&(s.enable(!1),this.miss(s)),!e&&s.enabled&&(s.activate(),this.currActive=s,e=!0)}this.currActive&&this.isMatch(this.currActive)&&this.matched(this.currActive)}}drawBoundery(){this.context.save(),this.context.strokeStyle=this.bounderyColor,this.context.lineWidth=this.bounderyWidth,this.context.lineWidth=10,this.context.shadowBlur=15,this.context.shadowColor=this.bounderyColor,this.context.beginPath(),this.context.moveTo(this.spawnCoords.min,this.topBoundery),this.context.lineTo(this.spawnCoords.max,this.topBoundery),this.context.stroke(),this.context.restore()}draw(){o.isPlaying()&&this.drawBoundery()}log(t){n.log("UserFace.js | "+t,i.findLogLevel("elements"))}getMatchedPoint(t){return t.position.y-F.getFontHeight()>this.topBoundery?U.getPerfect():U.getBad()}isMatch(t){return!!this.user.isExpression(t.type)}isOutOfBounds(t){return t.currY+F.getFontHeight()/2<this.topBoundery}}class _{constructor(t,e,s){this.body=t,this.video=e,this.canvas=s,this.context=this.getCanvasContext(),this.init(),this.reportDevTools()}init(){this.elements=[],this.setupStates(),this.setupStage(),this.buildElements(),this.bindEvents(),this.render()}setupStates(){}setupStage(){this.fps=60,this.time={interval:1e3/this.fps,lastTime:(new Date).getTime(),currentTime:0,delta:0}}buildElements(){this.guiManager=this.addToElem(new S(this.canvas,this.context)),this.faceDetect=this.addToElem(new L(this.video,this.body)),this.user=this.addToElem(new G(this.canvas,this.context)),this.wordSpawner=this.addToElem(new A(this.canvas,this.context)),this.faceSpawner=this.addToElem(new k(this.canvas,this.context)),this.userFace=this.addToElem(new H(this.canvas,this.context,this.user,this.faceSpawner,this.wordSpawner))}addToElem(t){return this.elements.push(t),t}bindEvents(){}onWindowResize(){let t=this.body.offsetHeight,e=this.body.offsetWidth;this.canvas.height=t,this.canvas.width=e,e>h.minimizeWidth?r.runCollection(this.elements,"minimize"):r.runCollection(this.elements,"maximize"),r.runCollection(this.elements,"onWindowResize",{width:e,height:t})}update(t){r.runCollection(this.elements,"update",t)}clearCanvas(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}draw(t){r.runCollection(this.elements,"draw",t)}render(){this.time.currentTime=(new Date).getTime(),this.time.delta=this.time.currentTime-this.time.lastTime,this.time.delta>this.time.interval&&(this.clearCanvas(),this.update(this.time.delta),this.draw(this.time.delta),this.time.lastTime=this.time.currentTime-this.time.delta%this.time.interval),requestAnimationFrame(()=>{this.render()})}getCanvasContext(){return this.canvas?this.canvas.getContext("2d"):null}reportDevTools(){n.canLog(i.findLogLevel("events"))&&a.reportEvents()}}!function(){const t=document.getElementById("main"),e=document.getElementById("video"),s=document.getElementById("canvas"),i=new _(t,e,s);function n(){i.onWindowResize()}window.onresize=n,n()}()}},[[11,1,3,2]]]);